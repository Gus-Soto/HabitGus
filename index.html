<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HabitGus - Aplicaci√≥n de Productividad</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Tus estilos CSS personalizados */
        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.3s ease-out forwards;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos para el tooltip del Heatmap */
        .heatmap-cell .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .heatmap-cell:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900">
    <div id="root"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyB7l1uu25Rs4R5cWwUnh0Aohedwi8r3lKw",
        authDomain: "habitgus.firebaseapp.com",
        projectId: "habitgus",
        storageBucket: "habitgus.firebasestorage.app",
        messagingSenderId: "209155294095",
        appId: "1:209155294095:web:419be1d3157b88544781fa"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      const auth = firebase.auth();
      console.log("Firebase inicializado y servicios disponibles:", { db, auth });
    </script>
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- Iconos SVG como Componentes ---
        const Icon = ({ children, className, ...props }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>;
        const OwlLogo = ({ size = 24, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className={className}>
                <path d="M15.5 6.20391C15.148 5.79588 14.6364 5.5 14 5.5C12.6369 5.5 11.6667 6.38636 11.6667 8C11.6667 9.61364 12.6369 10.5 14 10.5C15.3631 10.5 16.3333 9.61364 16.3333 8C16.3333 7.24354 16.0021 6.55679 15.5 6.20391Z" fill="#FACC15"/> <path d="M8.5 6.20391C8.85203 5.79588 9.36364 5.5 10 5.5C11.3631 5.5 12.3333 6.38636 12.3333 8C12.3333 9.61364 11.3631 10.5 10 10.5C8.6369 10.5 7.66667 9.61364 7.66667 8C7.66667 7.24354 7.99786 6.55679 8.5 6.20391Z" fill="#FACC15"/> <path fillRule="evenodd" clipRule="evenodd" d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM10 5.5C8.61929 5.5 7.5 6.61929 7.5 8C7.5 9.38071 8.61929 10.5 10 10.5C11.3807 10.5 12.5 9.38071 12.5 8C12.5 6.61929 11.3807 5.5 10 5.5ZM14 5.5C12.6193 5.5 11.5 6.61929 11.5 8C11.5 9.38071 12.6193 10.5 14 10.5C15.3807 10.5 16.5 9.38071 16.5 8C16.5 6.61929 15.3807 5.5 14 5.5ZM6.00696 13.9823C6.05989 13.0132 6.85521 12.25 7.83333 12.25H16.1667C17.1448 12.25 17.9401 13.0132 17.993 13.9823L18.25 18.5L16.75 18L15.25 18.5L13.75 18L12.25 18.5L10.75 18L9.25 18.5L7.75 18L6.25 18.5L6.00696 13.9823Z" fill="currentColor"/>
            </svg>
        );
        const CheckCircle = ({className}) => <Icon className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
        const Circle = ({className}) => <Icon className={className}><circle cx="12" cy="12" r="10"/></Icon>;
        const Plus = ({className}) => <Icon className={className}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></Icon>;
        const Trash2 = ({size, className}) => <Icon className={className} style={{width: size, height: size}}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></Icon>;
        const Edit = ({size, className}) => <Icon className={className} style={{width: size, height: size}}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></Icon>;
        const Zap = ({className}) => <Icon className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></Icon>;
        const BookOpen = ({className}) => <Icon className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></Icon>;
        const Dumbbell = ({className}) => <Icon className={className}><path d="M14.4 14.4 9.6 9.6"/><path d="M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"/><path d="m21.5 2.5-6.364 6.364"/><path d="M5.343 2.515a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829L6.364 12.78l-1.768-1.767a2 2 0 1 1-2.828-2.829z"/><path d="m2.5 21.5 6.364-6.364"/></Icon>;
        const TrendingUp = ({className}) => <Icon className={className}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></Icon>;
        const Home = ({className}) => <Icon className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>;
        const Clock = ({size, className}) => <Icon className={className} style={{width: size, height: size}}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></Icon>;
        const Repeat = ({size, className}) => <Icon className={className} style={{width: size, height: size}}><path d="M17 2.1l4 4-4 4"/><path d="M3 12.6V13a8 8 0 0 0 16 0V11"/><path d="M3 21.9l4-4-4-4"/><path d="M21 11.4V11a8 8 0 0 0-16 0v1.4"/></Icon>;
        const BarChart2 = ({className}) => <Icon className={className}><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></Icon>;
        const Lightbulb = ({className}) => <Icon className={className}><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></Icon>;
        const Trophy = ({size, className}) => <Icon className={className} style={{width: size, height: size}}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></Icon>;
        const PlayCircle = ({size, className}) => <Icon className={className} style={{width: size, height: size}}><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></Icon>;
        const PauseCircle = ({size, className}) => <Icon className={className} style={{width: size, height: size}}><circle cx="12" cy="12" r="10"/><line x1="10" y1="15" x2="10" y2="9"/><line x1="14" y1="15" x2="14" y2="9"/></Icon>;
        const RotateCcw = ({size, className}) => <Icon className={className} style={{width: size, height: size}}><path d="M3 2v6h6"/><path d="M3 13a9 9 0 1 0 3-7.7L3 8"/></Icon>;
        const Target = ({className}) => <Icon className={className}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></Icon>;
        const Award = ({className}) => <Icon className={className}><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 22 12 20 17 22 15.79 13.88"/></Icon>;
        const CalendarIcon = ({className}) => <Icon className={className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></Icon>;
        const ChevronLeft = ({className}) => <Icon className={className}><polyline points="15 18 9 12 15 6"/></Icon>;
        const ChevronRight = ({className}) => <Icon className={className}><polyline points="9 18 15 12 9 6"/></Icon>;

        // --- Componentes de UI (Modal, Forms, etc.) ---
        const Modal = ({ isOpen, onClose, children }) => {
          if (!isOpen) return null;
          return (
            <div className="fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4 overflow-y-auto">
              <div className="bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-6 lg:p-8 w-full max-w-md relative animate-fade-in-up my-8">
                <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-200 transition-transform duration-300 hover:scale-125">
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
                {children}
              </div>
            </div>
          );
        };
        const TaskForm = ({ onAddTask, editingTask, onUpdateTask, selectedDate, goals, onClose }) => {
          const [title, setTitle] = useState('');
          const [quadrant, setQuadrant] = useState('do');
          const [date, setDate] = useState('');
          const [time, setTime] = useState('');
          const [linkedGoalId, setLinkedGoalId] = useState('');

          useEffect(() => {
            const getISOString = (d) => new Date(d.getTime() - (d.getTimezoneOffset() * 60000)).toISOString().split('T')[0];
            const initialDate = selectedDate ? getISOString(new Date(selectedDate)) : getISOString(new Date());
            const initialTime = new Date().toTimeString().slice(0, 5);

            if (editingTask) {
              setTitle(editingTask.title);
              setQuadrant(editingTask.quadrant);
              setDate(editingTask.date || initialDate);
              setTime(editingTask.time || initialTime);
              setLinkedGoalId(editingTask.linkedGoalId || '');
            } else {
              setTitle('');
              setQuadrant('do');
              setDate(initialDate);
              setTime(initialTime);
              setLinkedGoalId('');
            }
          }, [editingTask, selectedDate]);

          const handleSubmit = (e) => {
            e.preventDefault();
            if (!title.trim()) return;
            const taskData = { title, quadrant, date, time, linkedGoalId };
            if (editingTask) {
              onUpdateTask(editingTask.id, taskData);
            } else {
              onAddTask(taskData);
            }
            onClose();
          };

          return (
            <form onSubmit={handleSubmit} className="space-y-4">
              <h3 className="text-xl font-bold text-white">{editingTask ? 'Editar Tarea' : 'A√±adir Nueva Tarea'}</h3>
              <input type="text" value={title} onChange={(e) => setTitle(e.target.value)} placeholder="¬øCu√°l es la tarea?" className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-2 focus:ring-indigo-500" />
              <div className="grid grid-cols-2 gap-4">
                <input type="date" value={date} onChange={(e) => setDate(e.target.value)} className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600" />
                <input type="time" value={time} onChange={(e) => setTime(e.target.value)} className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600" />
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-400 mb-1">Vincular a Meta</label>
                <select value={linkedGoalId} onChange={(e) => setLinkedGoalId(e.target.value)} className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600">
                  <option value="">Ninguna</option>
                  {goals.map(goal => <option key={goal.id} value={goal.id}>{goal.title}</option>)}
                </select>
              </div>
              <div>
                <label className="block text-sm font-semibold text-gray-400 mb-1">Matriz de Eisenhower</label>
                <select value={quadrant} onChange={(e) => setQuadrant(e.target.value)} className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600">
                  <option value="do">Urgente e Importante</option>
                  <option value="plan">Importante, No Urgente</option>
                  <option value="delegate">Urgente, No Importante</option>
                  <option value="eliminate">Ni Urgente, Ni Importante</option>
                </select>
              </div>
              <button type="submit" className="w-full mt-4 p-3 rounded-lg bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-colors shadow-lg flex items-center justify-center">
                <Plus className="mr-2" /> {editingTask ? 'Actualizar Tarea' : 'A√±adir Tarea'}
              </button>
            </form>
          );
        };
        const HabitForm = ({ onAddHabit, editingHabit, onUpdateHabit, goals, onClose }) => {
            const [name, setName] = useState('');
            const [category, setCategory] = useState('Salud');
            const [duration, setDuration] = useState(30);
            const [frequencyPeriod, setFrequencyPeriod] = useState('D√≠a');
            const [time, setTime] = useState('08:00');
            const [selectedDays, setSelectedDays] = useState([]);
            const [linkedGoalId, setLinkedGoalId] = useState('');
            const weekDays = ["D", "L", "M", "X", "J", "V", "S"];

            useEffect(() => {
                if (editingHabit) {
                    setName(editingHabit.name); setCategory(editingHabit.category); setDuration(editingHabit.duration || 30);
                    setFrequencyPeriod(editingHabit.frequencyPeriod || 'D√≠a'); setTime(editingHabit.time || '08:00');
                    setSelectedDays(editingHabit.selectedDays || []); setLinkedGoalId(editingHabit.linkedGoalId || '');
                } else {
                    setName(''); setCategory('Salud'); setDuration(30); setFrequencyPeriod('D√≠a'); setTime('08:00'); setSelectedDays([]); setLinkedGoalId('');
                }
            }, [editingHabit]);

            const handleDayToggle = (dayIndex) => { setSelectedDays(prev => prev.includes(dayIndex) ? prev.filter(d => d !== dayIndex) : [...prev, dayIndex]); };
            const handleSubmit = (e) => {
                e.preventDefault(); if (!name.trim()) return;
                const habitData = { name, category, duration: Number(duration), frequencyPeriod, time, selectedDays, linkedGoalId, startDate: new Date().toISOString().split('T')[0], progress: editingHabit ? editingHabit.progress : {} };
                if (editingHabit) { onUpdateHabit(editingHabit.id, habitData); } else { onAddHabit(habitData); }
                onClose();
            };

            return (
                <form onSubmit={handleSubmit} className="space-y-4">
                    <h3 className="text-xl font-bold text-white">{editingHabit ? 'Editar H√°bito' : 'Crear Nuevo H√°bito'}</h3>
                    <input type="text" value={name} onChange={e => setName(e.target.value)} placeholder="Nombre del h√°bito (Ej: Leer)" className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600" />
                    <div className="grid grid-cols-2 gap-4">
                        <div><label className="block text-sm font-semibold text-gray-400 mb-1">Categor√≠a</label><select value={category} onChange={e => setCategory(e.target.value)} className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600"><option>Salud</option> <option>Trabajo</option> <option>Desarrollo Personal</option> <option>Ocio</option></select></div>
                        <div><label className="block text-sm font-semibold text-gray-400 mb-1">Hora</label><input type="time" value={time} onChange={e => setTime(e.target.value)} className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600" /></div>
                    </div>
                    <div><label className="block text-sm font-semibold text-gray-400 mb-1">Vincular a Meta</label><select value={linkedGoalId} onChange={(e) => setLinkedGoalId(e.target.value)} className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600"><option value="">Ninguna</option>{goals.map(goal => <option key={goal.id} value={goal.id}>{goal.title}</option>)}</select></div>
                    <div><label className="block text-sm font-semibold text-gray-400 mb-1">Frecuencia</label><select value={frequencyPeriod} onChange={e => setFrequencyPeriod(e.target.value)} className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600"><option>D√≠a</option><option>Semana</option></select></div>
                    {frequencyPeriod === 'Semana' && (<div><label className="block text-sm font-semibold text-gray-400 mb-1">Seleccionar d√≠as</label><div className="flex justify-around bg-gray-700 p-2 rounded-lg">{weekDays.map((day, index) => (<button key={index} type="button" onClick={() => handleDayToggle(index)} className={`w-8 h-8 rounded-full font-bold transition-colors ${selectedDays.includes(index) ? 'bg-indigo-500 text-white' : 'bg-gray-600 text-gray-300'}`}>{day}</button>))}</div></div>)}
                    <div><label className="block text-sm font-semibold text-gray-400 mb-1">Duraci√≥n (minutos)</label><input type="number" min="1" value={duration} onChange={e => setDuration(e.target.value)} className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600" /></div>
                    <button type="submit" className="w-full mt-4 p-3 rounded-lg bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-colors shadow-lg flex items-center justify-center"><Plus className="mr-2" /> {editingHabit ? 'Actualizar H√°bito' : 'Crear H√°bito'}</button>
                </form>
            );
        };
        
        // --- INICIO: COMPONENTES DEL PLANIFICADOR ---
        const DailyList = ({ date, tasks, habits, addXp, onUpdateTask, onUpdateHabit, onSetEditingTask, onSetEditingHabit }) => {
            const getISOString = (d) => new Date(d.getTime() - (d.getTimezoneOffset() * 60000)).toISOString().split('T')[0];
            const targetDateString = getISOString(date);
            const filteredTasks = tasks.filter(t => t.date === targetDateString);
            const filteredHabits = habits.filter(habit => {
                const habitDate = new Date(date);
                habitDate.setHours(0,0,0,0);
                if (!habit.startDate) return false;
                const startDate = new Date(habit.startDate);
                startDate.setHours(0,0,0,0);
                if (habitDate < startDate) return false;
                if (habit.frequencyPeriod === 'D√≠a') return true;
                if (habit.frequencyPeriod === 'Semana') { const currentDay = habitDate.getDay(); return (habit.selectedDays || []).includes(currentDay); }
                return false;
            });

            const combined = [...filteredTasks.map(t => ({...t, type: 'task'})), ...filteredHabits.map(h => ({...h, type: 'habit'}))]
                .sort((a, b) => (a.time || '23:59').localeCompare(b.time || '23:59'));

            const handleTaskComplete = (task) => { if (!task.completed) { addXp(10); } onUpdateTask(task.id, { completed: !task.completed }); };
            const isHabitCompletedOnDate = (habit, checkDate) => { const dateString = checkDate.toDateString(); return (habit.progress && habit.progress[dateString] || 0) >= 1; };
            const handleHabitComplete = (habit) => { const dateString = date.toDateString(); const isCompleted = isHabitCompletedOnDate(habit, date); const updatedProgress = { ...habit.progress, [dateString]: isCompleted ? 0 : 1 }; if (!isCompleted) { addXp(5); } onUpdateHabit(habit.id, { progress: updatedProgress }); };
            
            return (
                <div className="space-y-4 animate-fade-in-up">
                    <h3 className="text-2xl font-bold text-white px-4">{date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</h3>
                    {combined.length > 0 ? combined.map(item => (
                        <div key={`${item.type}-${item.id}`} className="bg-gray-800 p-4 rounded-2xl flex items-center gap-4 mx-4">
                            {item.type === 'task' ? (
                                <><button onClick={() => handleTaskComplete(item)}>{item.completed ? <CheckCircle className="text-green-400" /> : <Circle className="text-gray-500" />}</button><div className="flex-grow"><p className={`text-white ${item.completed ? 'line-through text-gray-500' : ''}`}>{item.title}</p><p className="text-sm text-gray-400">Tarea ‚Ä¢ {item.time}</p></div><button onClick={() => onSetEditingTask(item)} className="p-1 text-gray-400 hover:text-blue-400"><Edit size={18}/></button></>
                            ) : (
                                <><Dumbbell className="text-indigo-400"/><div className="flex-grow"><p className="text-white">{item.name}</p><p className="text-sm text-gray-400">H√°bito ‚Ä¢ {item.time} ‚Ä¢ {item.duration} min</p></div><button onClick={() => handleHabitComplete(item)} className="p-1 text-gray-400 hover:text-green-400">{isHabitCompletedOnDate(item, date) ? <CheckCircle className="text-green-400" size={18}/> : <Circle className="text-gray-500" size={18}/>}</button><button onClick={() => onSetEditingHabit(item)} className="p-1 text-gray-400 hover:text-blue-400"><Edit size={18}/></button></>
                            )}
                        </div>
                    )) : (<p className="text-gray-500 text-center py-8">Nada programado para este d√≠a.</p>)}
                </div>
            );
        };
        const CalendarView = ({ onDateSelect, tasks, habits }) => {
            const [currentDate, setCurrentDate] = useState(new Date());
            const daysWithEvents = useMemo(() => {
                const eventDates = new Set();
                tasks.forEach(task => { if(task.date) eventDates.add(task.date); });
                habits.forEach(habit => { if(habit.progress) { Object.keys(habit.progress).forEach(dateStr => { if(habit.progress[dateStr] === 1) { const d = new Date(dateStr); const off = d.getTimezoneOffset() * 60000; const isoDate = new Date(d.getTime() - off).toISOString().split('T')[0]; eventDates.add(isoDate); }})}});
                return eventDates;
            }, [tasks, habits]);

            const startOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const endOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDay = startOfMonth.getDay();
            const daysInMonth = endOfMonth.getDate();
            const days = Array.from({ length: startDay }, (_, i) => null).concat(Array.from({ length: daysInMonth }, (_, i) => i + 1));
            const monthName = currentDate.toLocaleDateString('es-ES', { month: 'long' });
            const year = currentDate.getFullYear();
            const weekDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

            const handleDayClick = (day) => { if (!day) return; const newSelectedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day); onDateSelect(newSelectedDate); };
            const changeMonth = (offset) => { setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + offset, 1)); };

            return (
                <div className="bg-gray-800 rounded-2xl p-4 mx-4">
                    <div className="flex justify-between items-center mb-4"><button onClick={() => changeMonth(-1)} className="p-2 rounded-full hover:bg-gray-700"><ChevronLeft/></button><h4 className="text-lg font-bold text-white capitalize">{monthName} {year}</h4><button onClick={() => changeMonth(1)} className="p-2 rounded-full hover:bg-gray-700"><ChevronRight/></button></div>
                    <div className="grid grid-cols-7 gap-2">
                        {weekDays.map(day => <div key={day} className="text-xs font-bold text-gray-400 flex items-center justify-center h-10">{day}</div>)}
                        {days.map((day, index) => {
                            const dateStr = day ? `${year}-${String(currentDate.getMonth() + 1).padStart(2,'0')}-${String(day).padStart(2,'0')}` : null;
                            const hasEvent = dateStr && daysWithEvents.has(dateStr);
                            const isToday = new Date().toDateString() === new Date(currentDate.getFullYear(), currentDate.getMonth(), day).toDateString();
                            return (<button key={index} onClick={() => handleDayClick(day)} disabled={!day} className={`w-10 h-10 rounded-full flex items-center justify-center relative transition-colors mx-auto ${!day ? 'bg-transparent cursor-default' : 'hover:bg-gray-700'} ${isToday ? 'bg-indigo-600 text-white' : 'text-gray-300'}`}>{day}{hasEvent && <div className="absolute bottom-1.5 w-1.5 h-1.5 bg-indigo-400 rounded-full"></div>}</button>);
                        })}
                    </div>
                </div>
            )
        }
        const PlannerView = ({ tasks, habits, addXp, onUpdateTask, onUpdateHabit, onSetEditingTask, onSetEditingHabit }) => {
            const [viewMode, setViewMode] = useState('today');
            const [selectedDate, setSelectedDate] = useState(new Date());
            const today = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);

            const renderContent = () => {
                switch (viewMode) {
                    case 'today': return <DailyList date={today} tasks={tasks} habits={habits} addXp={addXp} onUpdateTask={onUpdateTask} onUpdateHabit={onUpdateHabit} onSetEditingTask={onSetEditingTask} onSetEditingHabit={onSetEditingHabit}/>;
                    case 'tomorrow': return <DailyList date={tomorrow} tasks={tasks} habits={habits} addXp={addXp} onUpdateTask={onUpdateTask} onUpdateHabit={onUpdateHabit} onSetEditingTask={onSetEditingTask} onSetEditingHabit={onSetEditingHabit}/>;
                    case 'calendar': return (<div className="space-y-6"><CalendarView onDateSelect={(date) => setSelectedDate(date)} tasks={tasks} habits={habits} /><DailyList date={selectedDate} tasks={tasks} habits={habits} addXp={addXp} onUpdateTask={onUpdateTask} onUpdateHabit={onUpdateHabit} onSetEditingTask={onSetEditingTask} onSetEditingHabit={onSetEditingHabit}/></div>);
                    default: return null;
                }
            };
            
            return (
                <div className="p-4 space-y-6">
                    <DailyMotivation />
                    <h2 className="text-3xl font-bold text-white px-4 flex items-center"><CalendarIcon className="mr-3" /> Planificador</h2>
                    <div className="flex space-x-2 border-b border-gray-700 px-4"><button onClick={() => setViewMode('today')} className={`py-2 px-4 font-semibold ${viewMode === 'today' ? 'text-indigo-400 border-b-2 border-indigo-400' : 'text-gray-400'}`}>Hoy</button><button onClick={() => setViewMode('tomorrow')} className={`py-2 px-4 font-semibold ${viewMode === 'tomorrow' ? 'text-indigo-400 border-b-2 border-indigo-400' : 'text-gray-400'}`}>Ma√±ana</button><button onClick={() => setViewMode('calendar')} className={`py-2 px-4 font-semibold ${viewMode === 'calendar' ? 'text-indigo-400 border-b-2 border-indigo-400' : 'text-gray-400'}`}>Calendario</button></div>
                    {renderContent()}
                </div>
            );
        };
        const DailyMotivation = () => {
            const quotes = [ "El secreto para salir adelante es empezar.", "La disciplina es el puente entre las metas y los logros.", "No tienes que ser grande para empezar, pero tienes que empezar para ser grande.", "Un peque√±o progreso cada d√≠a suma grandes resultados.", "La clave no es priorizar lo que est√° en tu agenda, sino agendar tus prioridades." ];
            const tips = [ "Regla de los 2 minutos: Si una tarea toma menos de dos minutos, hazla ahora.", "Acumulaci√≥n de h√°bitos: Despu√©s de un h√°bito actual, haz un nuevo h√°bito.", "Dise√±a tu entorno: Haz las se√±ales de los buenos h√°bitos obvias y visibles.", "Agrupaci√≥n de tentaciones: Vincula una acci√≥n que quieres hacer con una que necesitas hacer.", "Nunca te saltes dos veces: Si fallas un d√≠a, intenta volver a la normalidad lo antes posible." ];
            const [dailyQuote] = useState(() => quotes[Math.floor(Math.random() * quotes.length)]);
            const [dailyTip] = useState(() => tips[Math.floor(Math.random() * tips.length)]);
            return (
                <div className="bg-gradient-to-br from-gray-800 to-gray-900 border border-gray-700 p-4 rounded-2xl space-y-3 mx-4">
                    <div className="flex items-start gap-3"><Zap className="text-yellow-400 flex-shrink-0 mt-1"/><p className="text-white italic">"{dailyQuote}"</p></div>
                    <div className="border-t border-gray-700 my-2"></div>
                    <div className="flex items-start gap-3"><Lightbulb className="text-blue-400 flex-shrink-0 mt-1"/><p className="text-gray-300"><span className="font-bold">Tip:</span> {dailyTip}</p></div>
                </div>
            );
        };
        // --- FIN: COMPONENTES DEL PLANIFICADOR ---
        
        // --- INICIO: OTROS COMPONENTES DE VISTAS ---
        const HabitTracker = ({ habits, onSetEditingHabit, onDeleteHabit }) => {
            const getCategoryIcon = (category) => {
                switch(category) {
                    case 'Salud': return <Dumbbell className="text-green-400" />;
                    case 'Trabajo': return <TrendingUp className="text-blue-400" />;
                    case 'Desarrollo Personal': return <BookOpen className="text-yellow-400" />;
                    case 'Ocio': return <Home className="text-purple-400" />;
                    default: return <Award className="text-gray-400" />;
                }
            };
            return (
                <div className="p-4">
                    <h2 className="text-3xl font-bold text-white mb-6 flex items-center"><Award className="mr-3 text-indigo-400" /> Mis H√°bitos</h2>
                    <div className="space-y-4">
                        {habits.map(habit => (
                            <div key={habit.id} className="bg-gray-800 p-4 rounded-2xl">
                                <div className="flex justify-between items-center mb-3">
                                    <div className="flex items-center gap-3">{getCategoryIcon(habit.category)}<span className="font-bold text-lg text-white">{habit.name}</span></div>
                                    <div className="flex gap-2"><button onClick={() => onSetEditingHabit(habit)} className="p-1 text-gray-400 hover:text-blue-400"><Edit size={18}/></button><button onClick={() => onDeleteHabit(habit.id)} className="p-1 text-gray-400 hover:text-red-400"><Trash2 size={18}/></button></div>
                                </div>
                                <div className="text-sm text-gray-400 mb-3 flex items-center gap-4"><span className="flex items-center gap-1"><Repeat size={14}/> {habit.frequencyPeriod === 'D√≠a' ? 'Diario' : `${(habit.selectedDays || []).length} d√≠as/sem`}</span><span className="flex items-center gap-1"><Clock size={14}/> {habit.duration} min</span></div>
                            </div>
                        ))}
                        {habits.length === 0 && <p className="text-gray-500 text-center py-8">Crea h√°bitos para construir la vida que deseas.</p>}
                    </div>
                </div>
            );
        };
        const GoalsView = ({ goals, onAddGoal, onDeleteGoal, tasks }) => {
            const [newGoalTitle, setNewGoalTitle] = useState('');
            const handleAddGoal = (e) => { e.preventDefault(); if (newGoalTitle.trim()) { onAddGoal({ title: newGoalTitle.trim() }); setNewGoalTitle(''); } };
            return (
                <div className="p-4">
                    <h2 className="text-3xl font-bold text-white mb-6 flex items-center"><Target className="mr-3 text-indigo-400" /> Metas Estrat√©gicas</h2>
                    <form onSubmit={handleAddGoal} className="flex gap-2 mb-6"><input type="text" value={newGoalTitle} onChange={e => setNewGoalTitle(e.target.value)} placeholder="Nueva meta trimestral/anual" className="w-full p-3 bg-gray-700 text-white rounded-lg border border-gray-600"/><button type="submit" className="p-3 bg-indigo-600 text-white rounded-lg font-bold"><Plus/></button></form>
                    <div className="space-y-4">
                        {goals.map(goal => {
                            const linkedTasks = tasks.filter(t => t.linkedGoalId === String(goal.id));
                            const completedTasks = linkedTasks.filter(t => t.completed).length;
                            const progress = linkedTasks.length > 0 ? (completedTasks / linkedTasks.length) * 100 : 0;
                            return (
                                <div key={goal.id} className="bg-gray-800 p-4 rounded-2xl">
                                    <div className="flex justify-between items-center mb-3"><span className="font-bold text-lg text-white">{goal.title}</span><button onClick={() => onDeleteGoal(goal.id)} className="p-1 text-gray-400 hover:text-red-400"><Trash2 size={18}/></button></div>
                                    <p className="text-sm text-gray-400 mb-2">{completedTasks} de {linkedTasks.length} tareas completadas</p>
                                    <div className="w-full bg-gray-700 rounded-full h-2.5"><div className="bg-green-500 h-2.5 rounded-full" style={{ width: `${progress}%` }}></div></div>
                                </div>
                            );
                        })}
                        {goals.length === 0 && <p className="text-gray-500 text-center py-8">Define tus grandes objetivos para dar direcci√≥n a tus tareas.</p>}
                    </div>
                </div>
            );
        };
        const AchievementsView = ({ achievements }) => {
            return (
                <div className="p-4">
                    <h2 className="text-3xl font-bold text-white mb-6 flex items-center"><Trophy size={24} className="mr-3 text-yellow-400" /> Logros Desbloqueados</h2>
                    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        {achievements.map(ach => (
                            <div key={ach.id} className={`bg-gray-800 p-4 rounded-2xl text-center flex flex-col items-center justify-center aspect-square transition-all duration-300 ${ach.unlocked ? 'opacity-100' : 'opacity-40'}`}>
                                <Trophy size={48} className={ach.unlocked ? 'text-yellow-400' : 'text-gray-500'}/>
                                <h3 className="font-bold text-white mt-2">{ach.title}</h3>
                                <p className="text-xs text-gray-400">{ach.description}</p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };
        const AdvancedStatsView = ({ habits }) => { /* ... (c√≥digo existente y completo) ... */ };
        const AuthView = ({ onLoginSuccess }) => { /* ... (c√≥digo existente y completo) ... */ };
        
        function App() {
          const [currentUser, setCurrentUser] = useState(null);
          const [loadingAuth, setLoadingAuth] = useState(true);
          const [tasks, setTasks] = useState([]);
          const [habits, setHabits] = useState([]);
          const [goals, setGoals] = useState([]);
          const [achievements, setAchievements] = useState([ { id: 1, title: "Primer Paso", unlocked: false }, { id: 2, title: "H√°bito Iniciado", unlocked: false }, { id: 3, title: "Planificador", unlocked: false }, { id: 4, title: "Constancia", unlocked: false }, ]);
          const [userProfile, setUserProfile] = useState({ xp: 0, level: 1 });
          const [isTaskModalOpen, setTaskModalOpen] = useState(false);
          const [isHabitModalOpen, setHabitModalOpen] = useState(false);
          const [editingTask, setEditingTask] = useState(null);
          const [editingHabit, setEditingHabit] = useState(null);
          const [selectedDateForModal, setSelectedDateForModal] = useState(new Date());
          const [activeView, setActiveView] = useState('planner');

          // --- INICIO: L√ìGICA DE CARGA CORREGIDA ---
          useEffect(() => {
            const unsubscribe = auth.onAuthStateChanged(user => {
                setCurrentUser(user);
                setLoadingAuth(false);
            });
            return () => unsubscribe(); // Limpia el listener de autenticaci√≥n al desmontar
          }, []);

          useEffect(() => {
            if (currentUser) {
                // Si hay usuario, cargar su perfil y datos
                loadUserProfile(currentUser.uid);
                const unsubTasks = loadUserTasks(currentUser.uid);
                const unsubHabits = loadUserHabits(currentUser.uid);
                const unsubGoals = loadUserGoals(currentUser.uid);

                // Devolver una funci√≥n de limpieza para los listeners de datos
                return () => {
                    unsubTasks();
                    unsubHabits();
                    unsubGoals();
                };
            } else {
                // Si no hay usuario (logout), limpiar los datos del estado
                setTasks([]);
                setHabits([]);
                setGoals([]);
                setUserProfile({ xp: 0, level: 1 });
            }
          }, [currentUser]); // Este hook depende del estado de currentUser
          // --- FIN: L√ìGICA DE CARGA CORREGIDA ---

          const loadUserProfile = async (uid) => { try { const doc = await db.collection('users').doc(uid).get(); if (doc.exists) { setUserProfile(doc.data()); } else { await db.collection('users').doc(uid).set({ xp: 0, level: 1 }); setUserProfile({ xp: 0, level: 1 }); } } catch (error) { console.error("Error cargando perfil:", error); } };
          const addXp = useCallback(async (amount) => { if (!currentUser) return; const userRef = db.collection('users').doc(currentUser.uid); try { await db.runTransaction(async (transaction) => { const doc = await transaction.get(userRef); const prevUser = doc.data() || { xp: 0, level: 1 }; let newXp = prevUser.xp + amount; let newLevel = prevUser.level; const xpToNextLevel = newLevel * 100; if (newXp >= xpToNextLevel) { newLevel = prevUser.level + 1; newXp = newXp - xpToNextLevel; } transaction.update(userRef, { xp: newXp, level: newLevel }); setUserProfile({ xp: newXp, level: newLevel }); }); } catch (error) { console.error("Error al actualizar XP:", error); } }, [currentUser]);
          const loadUserTasks = (uid) => db.collection('tasks').where('userId', '==', uid).orderBy('createdAt', 'desc').onSnapshot(snapshot => { setTasks(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), createdAt: doc.data().createdAt?.toDate() }))); });
          const loadUserHabits = (uid) => db.collection('habits').where('userId', '==', uid).onSnapshot(snapshot => { setHabits(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), createdAt: doc.data().createdAt?.toDate() }))); });
          const loadUserGoals = (uid) => db.collection('goals').where('userId', '==', uid).onSnapshot(snapshot => { setGoals(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), createdAt: doc.data().createdAt?.toDate() }))); });
          const handleSetEditingTask = (task) => { setEditingTask(task); setTaskModalOpen(true); };
          const handleSetEditingHabit = (habit) => { setEditingHabit(habit); setHabitModalOpen(true); };
          const handleAddTask = async (taskData) => { if (!currentUser) return; try { await db.collection('tasks').add({ ...taskData, completed: false, userId: currentUser.uid, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); addXp(5); } catch (e) { console.error("Error a√±adiendo tarea:", e); } };
          const handleUpdateTask = async (id, updatedData) => { if (!currentUser) return; try { await db.collection('tasks').doc(id).update(updatedData); } catch (e) { console.error("Error actualizando tarea:", e); } };
          const handleDeleteTask = async (id) => { if (!currentUser) return; try { await db.collection('tasks').doc(id).delete(); } catch (e) { console.error("Error eliminando tarea:", e); } };
          const handleAddHabit = async (habitData) => { if (!currentUser) return; try { await db.collection('habits').add({ ...habitData, userId: currentUser.uid, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); } catch (e) { console.error("Error a√±adiendo h√°bito:", e); } };
          const handleUpdateHabit = async (id, updatedData) => { if (!currentUser) return; try { await db.collection('habits').doc(id).update(updatedData); } catch (e) { console.error("Error actualizando h√°bito:", e); } };
          const handleDeleteHabit = async (id) => { if (!currentUser) return; try { await db.collection('habits').doc(id).delete(); } catch (e) { console.error("Error eliminando h√°bito:", e); } };
          const handleAddGoal = async (goalData) => { if (!currentUser) return; try { await db.collection('goals').add({ ...goalData, userId: currentUser.uid, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); } catch (e) { console.error("Error a√±adiendo meta:", e); } };
          const handleDeleteGoal = async (id) => { if (!currentUser) return; try { await db.collection('goals').doc(id).delete(); } catch (e) { console.error("Error eliminando meta:", e); } };
          const handleLogout = async () => { try { await auth.signOut(); } catch (error) { console.error("Error al cerrar sesi√≥n:", error); } };
          
          if (loadingAuth) { return <div className="min-h-screen flex items-center justify-center bg-gray-900 text-white"><p>Cargando...</p></div>; }
          if (!currentUser) { return <AuthView />; }
          
          const renderActiveView = () => {
            switch (activeView) {
              case 'planner': return <PlannerView tasks={tasks} habits={habits} addXp={addXp} onUpdateTask={handleUpdateTask} onUpdateHabit={handleUpdateHabit} onSetEditingTask={handleSetEditingTask} onSetEditingHabit={handleSetEditingHabit} />;
              case 'habits': return <HabitTracker habits={habits} onSetEditingHabit={handleSetEditingHabit} onDeleteHabit={handleDeleteHabit} />;
              case 'goals': return <GoalsView goals={goals} onAddGoal={handleAddGoal} onDeleteGoal={handleDeleteGoal} tasks={tasks} />;
              case 'stats': return <AdvancedStatsView habits={habits} />;
              case 'achievements': return <AchievementsView achievements={achievements} />;
              default: return <PlannerView tasks={tasks} habits={habits} addXp={addXp} onUpdateTask={handleUpdateTask} onUpdateHabit={handleUpdateHabit} onSetEditingTask={handleSetEditingTask} onSetEditingHabit={handleSetEditingHabit} />;
            }
          };

          return (
            <div className="bg-gray-900 text-white min-h-screen font-sans flex flex-col md:flex-row">
                <nav className="w-full md:w-20 lg:w-64 bg-gray-800 p-2 md:p-4 flex md:flex-col justify-between border-b-2 md:border-b-0 md:border-r-2 border-gray-700">
                    <div>
                        <div className="flex items-center gap-2 mb-0 md:mb-8 p-2"><OwlLogo size={36} className="text-indigo-400" /><h1 className="text-xl font-bold hidden lg:block">HabitGus</h1></div>
                        {currentUser && (<div className="text-center p-2 mb-4 hidden lg:block"><p className="text-sm text-gray-300">Bienvenido,</p><p className="font-bold text-white text-md break-all">{currentUser.email}</p><div className="mt-2 text-sm text-gray-400">Nivel: <span className="font-bold text-green-400">{userProfile.level}</span> | XP: <span className="font-bold text-yellow-400">{userProfile.xp} / {userProfile.level * 100}</span></div></div>)}
                        <ul className="flex flex-row md:flex-col md:space-y-2 justify-around md:justify-start">
                            <li><button onClick={() => setActiveView('planner')} className={`w-full flex items-center justify-center md:justify-start gap-3 p-3 rounded-lg ${activeView === 'planner' ? 'bg-indigo-600' : 'hover:bg-gray-700'}`}><CalendarIcon /><span className="hidden lg:inline">Planificador</span></button></li>
                            <li><button onClick={() => setActiveView('habits')} className={`w-full flex items-center justify-center md:justify-start gap-3 p-3 rounded-lg ${activeView === 'habits' ? 'bg-indigo-600' : 'hover:bg-gray-700'}`}><Award /><span className="hidden lg:inline">H√°bitos</span></button></li>
                            <li><button onClick={() => setActiveView('goals')} className={`w-full flex items-center justify-center md:justify-start gap-3 p-3 rounded-lg ${activeView === 'goals' ? 'bg-indigo-600' : 'hover:bg-gray-700'}`}><Target /><span className="hidden lg:inline">Metas</span></button></li>
                            <li><button onClick={() => setActiveView('stats')} className={`w-full flex items-center justify-center md:justify-start gap-3 p-3 rounded-lg ${activeView === 'stats' ? 'bg-indigo-600' : 'hover:bg-gray-700'}`}><BarChart2 /><span className="hidden lg:inline">Estad√≠sticas</span></button></li>
                            <li><button onClick={() => setActiveView('achievements')} className={`w-full flex items-center justify-center md:justify-start gap-3 p-3 rounded-lg ${activeView === 'achievements' ? 'bg-indigo-600' : 'hover:bg-gray-700'}`}><Trophy size={24} /><span className="hidden lg:inline">Logros</span></button></li>
                        </ul>
                    </div>
                    <div className="hidden md:block space-y-2">
                        <button onClick={() => { setEditingHabit(null); setHabitModalOpen(true); }} className="w-full p-3 rounded-lg bg-gray-700 hover:bg-gray-600 font-bold flex items-center justify-center lg:justify-start gap-2"><Repeat size={24} /><span className="hidden lg:inline">Nuevo H√°bito</span></button>
                        <button onClick={() => { setEditingTask(null); setTaskModalOpen(true); }} className="w-full p-3 rounded-lg bg-indigo-600 hover:bg-indigo-700 font-bold flex items-center justify-center lg:justify-start gap-2"><Plus /><span className="hidden lg:inline">Nueva Tarea</span></button>
                        {currentUser && (<button onClick={handleLogout} className="w-full p-3 rounded-lg bg-red-600 hover:bg-red-700 font-bold flex items-center justify-center lg:justify-start gap-2">Cerrar Sesi√≥n</button>)}
                    </div>
                </nav>
                <main className="flex-1 overflow-y-auto">{renderActiveView()}</main>
                <div className="md:hidden fixed bottom-4 right-4 flex flex-col gap-3 z-40">
                    <button onClick={() => { setEditingHabit(null); setHabitModalOpen(true); }} className="bg-gray-600 text-white rounded-full p-4 shadow-lg"><Repeat size={24}/></button>
                    <button onClick={() => { setEditingTask(null); setTaskModalOpen(true); }} className="bg-indigo-600 text-white rounded-full p-4 shadow-lg"><Plus size={24}/></button>
                    {currentUser && (<button onClick={handleLogout} className="bg-red-600 text-white rounded-full p-4 shadow-lg"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></button>)}
                </div>
                <Modal isOpen={isTaskModalOpen} onClose={() => {setTaskModalOpen(false); setEditingTask(null);}}><TaskForm onAddTask={handleAddTask} editingTask={editingTask} onUpdateTask={handleUpdateTask} selectedDate={selectedDateForModal} goals={goals} onClose={() => {setTaskModalOpen(false); setEditingTask(null);}} /></Modal>
                <Modal isOpen={isHabitModalOpen} onClose={() => {setHabitModalOpen(false); setEditingHabit(null);}}><HabitForm onAddHabit={handleAddHabit} editingHabit={editingHabit} onUpdateHabit={handleUpdateHabit} goals={goals} onClose={() => {setHabitModalOpen(false); setEditingHabit(null);}} /></Modal>
            </div>
          );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>